---
import Layout from "../layouts/Layout.astro";
import HeroSection from "../components/HeroSection.astro";
import BiographySection from "../components/BiographySection.astro";
import ContactSection from "../components/ContactSection.astro";
import TrajectorySection from "../components/TrajectorySection.astro";
---

<Layout
	title="Martin Salas - Candidato al Congreso 2026"
	description="Propuestas para mejorar la educación, salud y empleo en el Perú"
	image="/martin-salas-og.jpg"
>
	<HeroSection/>
	<BiographySection/>
	<TrajectorySection/>
	<ContactSection/>

	<div class="fixed bottom-6 left-6 z-50">
		<div class="flex items-center gap-3 rounded-2xl bg-white px-5 py-3 shadow-xl ring-1 ring-black/5 backdrop-blur">
			<div class="flex h-10 w-10 items-center justify-center rounded-full text-white shadow-md">
				<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640">
					<path d="M320 96C239.2 96 174.5 132.8 127.4 176.6C80.6 220.1 49.3 272 34.4 307.7C31.1 315.6 31.1 324.4 34.4 332.3C49.3 368 80.6 420 127.4 463.4C174.5 507.1 239.2 544 320 544C400.8 544 465.5 507.2 512.6 463.4C559.4 419.9 590.7 368 605.6 332.3C608.9 324.4 608.9 315.6 605.6 307.7C590.7 272 559.4 220 512.6 176.6C465.5 132.9 400.8 96 320 96zM176 320C176 240.5 240.5 176 320 176C399.5 176 464 240.5 464 320C464 399.5 399.5 464 320 464C240.5 464 176 399.5 176 320zM320 256C320 291.3 291.3 320 256 320C244.5 320 233.7 317 224.3 311.6C223.3 322.5 224.2 333.7 227.2 344.8C240.9 396 293.6 426.4 344.8 412.7C396 399 426.4 346.3 412.7 295.1C400.5 249.4 357.2 220.3 311.6 224.3C316.9 233.6 320 244.4 320 256z"/>
				</svg>
			</div>
			<div class="flex flex-col leading-tight">
				<span class="text-xs font-medium uppercase tracking-wide text-gray-500">Visitas</span>
				<span id="view-counter" class="text-xl font-bold text-gray-900 tabular-nums">0</span>
			</div>
		</div>
	</div>

</Layout>

<script is:inline>
	const API_BASE = "https://api-servitecsales.web.app";
	const COUNTER_KEY = "hasVisitedWebsite";

	const getCounter = async () => {
		const res = await fetch(`${API_BASE}/get-counter`);
		const data = await res.json();
		return data.counter;
	};

	const updateCounter = async () => {
		const res = await fetch(`${API_BASE}/update-counter`, {
			method: "PUT",
		});
		const data = await res.json();
		return data.counter;
	};

	const initCounter = async () => {
		const counterElement = document.getElementById("view-counter");
		if (!counterElement) return;

		try {
			const hasVisited = localStorage.getItem(COUNTER_KEY);
			let counter;

			if (!hasVisited) {
				counter = await updateCounter();
				localStorage.setItem(COUNTER_KEY, "true");
			} else {
				counter = await getCounter();
			}

			counterElement.textContent = counter.toLocaleString("es-PE");
		} catch (error) {
			console.error("Error loading counter:", error);
		}
	};

	document.addEventListener("DOMContentLoaded", initCounter);
</script>
